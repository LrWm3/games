<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>REPLY ALL - Corporate FFA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --win-grey: #c0c0c0;
            --win-blue: #000080;
            --win-border-light: #ffffff;
            --win-border-dark: #404040;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #008080;
            height: 100dvh;
            overflow: hidden;
            touch-action: manipulation;
        }

        .retro-border {
            border-top: 2px solid var(--win-border-light);
            border-left: 2px solid var(--win-border-light);
            border-bottom: 2px solid var(--win-border-dark);
            border-right: 2px solid var(--win-border-dark);
        }

        .retro-border-inset {
            border-top: 2px solid var(--win-border-dark);
            border-left: 2px solid var(--win-border-dark);
            border-bottom: 2px solid var(--win-border-light);
            border-right: 2px solid var(--win-border-light);
        }

        .retro-button {
            background: var(--win-grey);
            border-top: 2px solid var(--win-border-light);
            border-left: 2px solid var(--win-border-light);
            border-bottom: 2px solid var(--win-border-dark);
            border-right: 2px solid var(--win-border-dark);
            padding: 4px 8px;
            cursor: pointer;
            user-select: none;
        }

        .retro-button:active:not(:disabled) {
            border-top: 2px solid var(--win-border-dark);
            border-left: 2px solid var(--win-border-dark);
            border-bottom: 2px solid var(--win-border-light);
            border-right: 2px solid var(--win-border-light);
            padding-top: 5px;
            padding-bottom: 3px;
        }

        .retro-button:disabled {
            color: #808080;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .terminal-font { font-family: 'VT323', monospace; }

        @keyframes shake {
            0%, 100% { transform: translate(0,0); }
            25% { transform: translate(-4px, 4px); }
            50% { transform: translate(4px, -4px); }
            75% { transform: translate(-4px, -4px); }
        }
        .shaking { animation: shake 0.2s ease-in-out infinite; }

        .scroll-container::-webkit-scrollbar { width: 14px; }
        .scroll-container::-webkit-scrollbar-track { background: #dfdfdf; }
        .scroll-container::-webkit-scrollbar-thumb { 
            background: var(--win-grey);
            border: 2px solid var(--win-border-light);
            box-shadow: inset -1px -1px 0 var(--win-border-dark);
        }

        .target-pill {
            transition: all 0.2s;
            border: 1px solid #808080;
        }
        .target-pill.active {
            background: #000080 !important;
            color: white !important;
            border-color: #ffffff;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .message-entry {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center p-0 md:p-4">

    <!-- START SCREEN -->
    <div id="start-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#008080] p-4 text-black">
        <div class="bg-[#c0c0c0] p-4 retro-border max-w-sm w-full shadow-2xl">
            <div class="bg-[#000080] text-white px-2 py-1 mb-4 flex justify-between items-center text-xs">
                <span>OUTLOOK SETUP WIZARD</span>
                <span>‚úï</span>
            </div>
            <h1 class="text-4xl font-bold mb-2 text-center terminal-font tracking-widest text-[#000080]">REPLY ALL</h1>
            <p class="mb-4 text-[11px] text-center leading-tight">A company-wide "Free For All" has broken out over the shared fridge. <br>Last employee with credibility wins.</p>
            
            <div class="space-y-3 mb-6">
                <div>
                    <label class="block text-[10px] font-bold uppercase mb-1">Your Full Name:</label>
                    <input id="player-name-input" type="text" placeholder="Eke" class="w-full p-2 bg-white retro-border-inset outline-none text-sm">
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase mb-1">Auto-Generated Email:</label>
                    <div id="email-preview" class="text-[11px] font-mono text-gray-800 bg-white/50 p-2 border border-dotted border-gray-400">...</div>
                </div>
            </div>
            
            <button onclick="startGame()" class="w-full py-3 font-bold retro-button text-[#000080]">CONNECT TO EXCHANGE SERVER</button>
        </div>
    </div>

    <!-- MAIN GAME INTERFACE -->
    <div id="game-ui" class="hidden flex flex-col w-full h-full max-w-5xl bg-[#c0c0c0] retro-border overflow-hidden text-black">
        
        <!-- Header -->
        <div class="bg-[#000080] text-white p-1 flex justify-between items-center shrink-0">
            <div class="flex items-center gap-2 px-1">
                <span class="text-xs font-bold truncate">Outlook Express - [Inbox]</span>
            </div>
            <div class="flex gap-1 pr-1">
                <button class="w-4 h-4 bg-[#c0c0c0] border border-white text-black text-[10px] flex items-center justify-center">_</button>
                <button class="w-4 h-4 bg-[#c0c0c0] border border-white text-black text-[10px] flex items-center justify-center">X</button>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="flex gap-1 p-1 bg-[#c0c0c0] border-b border-[#808080] overflow-x-auto shrink-0 no-scrollbar">
            <button class="retro-button text-[10px] flex items-center gap-1 whitespace-nowrap"><span>üìß</span> New Mail</button>
            <button class="retro-button text-[10px] flex items-center gap-1 whitespace-nowrap"><span>üóëÔ∏è</span> Trash</button>
            <div class="flex-grow"></div>
            <div id="turn-clock" class="text-[10px] bg-white px-2 py-1 retro-border-inset font-mono">09:00 AM</div>
        </div>

        <div class="flex flex-grow overflow-hidden relative">
            
            <!-- Main Thread Area -->
            <div class="flex-grow flex flex-col bg-white overflow-hidden">
                <!-- Thread Details (INTERACTIVE HEADERS) -->
                <div class="p-2 bg-[#f0f0f0] border-b border-[#808080] text-[11px] shrink-0 space-y-1">
                    <div class="flex items-start gap-2 overflow-x-auto no-scrollbar py-0.5">
                        <strong class="mt-1 shrink-0">From:</strong> 
                        <div id="target-selector" class="flex gap-2">
                            <!-- Target Buttons (Karen, Greg, Chad) -->
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <strong>To:</strong> 
                        <span id="player-email-display" class="text-blue-800 bg-blue-50 px-1 border border-blue-200">you@org.gov</span>
                    </div>
                    <div class="flex gap-2 flex-wrap items-center" id="active-ccs">
                        <strong>CC:</strong> <span class="text-gray-400 italic">No external eyes yet...</span>
                    </div>
                    <div class="border-t border-gray-300 pt-1">
                        <strong>Subject:</strong> <span class="font-bold text-red-700">RE: URGENT: The "No Fish in the Microwave" Policy</span>
                    </div>
                </div>

                <!-- Message History -->
                <div id="message-log" class="flex-grow overflow-y-auto p-3 space-y-3 scroll-container bg-white font-serif text-sm">
                    <!-- Initial Email injected here -->
                </div>

                <!-- Mobile HP Bar -->
                <div class="md:hidden px-4 py-2 bg-[#dfdfdf] border-t border-[#808080]">
                    <div class="flex justify-between text-[10px] mb-1 font-bold">
                        <span>YOUR CREDIBILITY</span>
                        <span id="mobile-hp-text">100%</span>
                    </div>
                    <div class="h-3 w-full bg-white border border-[#808080]">
                        <div id="mobile-hp-fill" class="h-full bg-green-500 transition-all duration-300 w-full"></div>
                    </div>
                </div>

                <!-- Action Controls -->
                <div class="p-3 bg-[#c0c0c0] border-t-2 border-white shrink-0">
                    <div class="grid grid-cols-2 gap-2 max-w-lg mx-auto">
                        <button onclick="performAction('CIRCLE_BACK')" class="retro-button py-2 flex flex-col items-center">
                            <span class="text-xs font-bold">Circle Back</span>
                            <span class="text-[9px] opacity-70">Direct Attack</span>
                        </button>
                        <button onclick="openAddressBook()" class="retro-button py-2 flex flex-col items-center">
                            <span class="text-xs font-bold">CC Someone</span>
                            <span class="text-[9px] opacity-70">Team Synergy</span>
                        </button>
                        <button onclick="performAction('OOO')" class="retro-button py-2 flex flex-col items-center">
                            <span class="text-xs font-bold">Go OOO</span>
                            <span class="text-[9px] opacity-70">Regain Standing</span>
                        </button>
                        <button id="reply-all-btn" onclick="performAction('REPLY_ALL')" class="retro-button py-2 flex flex-col items-center disabled:opacity-50" disabled>
                            <span class="text-xs font-bold text-red-800 uppercase">Reply All</span>
                            <span class="text-[9px] opacity-70" id="ult-label">Leverage: 0%</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Desktop Stats Panel -->
            <div class="hidden lg:flex w-64 bg-[#dfdfdf] border-l border-[#808080] flex-col p-3 shrink-0">
                <div class="text-[10px] font-bold mb-2 uppercase">Your Employee Profile</div>
                <div class="bg-white p-2 retro-border-inset mb-4">
                    <div id="desktop-name" class="text-xs font-bold text-[#000080] truncate">Employee</div>
                    <div class="text-[9px] text-gray-500 mb-2 truncate" id="desktop-email">email@org.gov</div>
                    
                    <div class="text-[9px] font-bold mb-1">CREDIBILITY (HP)</div>
                    <div class="h-4 bg-gray-200 border border-[#808080] relative mb-3">
                        <div id="desktop-hp-fill" class="h-full bg-green-500 transition-all w-full"></div>
                        <div id="desktop-hp-text" class="absolute inset-0 flex items-center justify-center text-[9px] font-bold">100/100</div>
                    </div>

                    <div class="text-[9px] font-bold mb-1">POLITICAL LEVERAGE</div>
                    <div class="h-2 bg-gray-200 border border-[#808080]">
                        <div id="desktop-ult-fill" class="h-full bg-yellow-400 transition-all w-0"></div>
                    </div>
                </div>

                <div class="text-[10px] font-bold mb-1 uppercase">Active CC Line</div>
                <div id="buff-list" class="space-y-1 overflow-y-auto text-[10px] italic text-gray-600">
                    No active synergy.
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: ADDRESS BOOK -->
    <div id="address-book" class="fixed inset-0 z-[110] bg-black/50 items-center justify-center p-4 hidden flex">
        <div class="bg-[#c0c0c0] retro-border w-full max-w-sm shadow-2xl">
            <div class="bg-[#000080] text-white px-2 py-1 flex justify-between items-center text-xs">
                <span>ADDRESS BOOK - SELECT CC</span>
                <button onclick="closeAddressBook()" class="px-1 hover:bg-red-600">‚úï</button>
            </div>
            <div class="p-2 text-[10px] bg-[#dfdfdf] border-b border-[#808080]">
                Choose a contact to loop in. They provide a permanent bonus to the thread.
            </div>
            <div id="contact-list" class="max-h-64 overflow-y-auto p-2 space-y-2 bg-white">
                <!-- Contacts -->
            </div>
            <div class="p-2 flex justify-end bg-[#c0c0c0]">
                <button onclick="closeAddressBook()" class="retro-button text-xs px-4 font-bold">CANCEL</button>
            </div>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        const CONTACTS = [
            { id: 'intern', name: "Kevin (Intern)", role: "Coffee Runner", bonus: "+7 Attack dmg per turn.", effect: { damage: 7 }, used: false },
            { id: 'it', name: "Pradeep (IT)", role: "SysAdmin", bonus: "Heal 5 Credibility every turn.", effect: { heal: 5 }, used: false },
            { id: 'legal', name: "The Firm (Legal)", role: "Compliance", bonus: "30% Damage Reduction.", effect: { defense: 0.3 }, used: false },
            { id: 'ceo', name: "Big Boss (CEO)", role: "Executive", bonus: "Double Leverage gain.", effect: { leverage: 2 }, used: false },
            { id: 'cat', name: "Mittens (Office Cat)", role: "Mascot", bonus: "15% chance for enemies to miss you entirely.", effect: { dodge: 0.15 }, used: false }
        ];

        let opponents = [
            { id: 1, name: "Karen (HR)", email: "karen.hr@org.gov", hp: 85, maxHp: 85, quotes: ["Looping in legal.", "Per my last email...", "Let's align on this.", "Respect the hierarchy."], color: 'text-purple-700' },
            { id: 2, name: "Greg (Fin)", email: "greg.accounting@org.gov", hp: 70, maxHp: 70, quotes: ["The ROI is negative.", "Bottom line: No.", "Expenses are too high.", "Fix your spreadsheets."], color: 'text-emerald-700' },
            { id: 3, name: "Chad (Sales)", email: "chad.crusher@org.gov", hp: 60, maxHp: 60, quotes: ["LET'S CRUSH IT!!", "Coffee is for closers.", "Synergy overload!", "Huge win today!"], color: 'text-orange-700' }
        ];

        let state = {
            player: {
                name: "Employee",
                email: "employee@org.gov",
                hp: 100,
                maxHp: 100,
                ult: 0,
                activeBuffs: []
            },
            targetId: 1,
            turn: 1,
            isProcessing: false,
            gameOver: false
        };

        // --- INIT ---

        const nameInput = document.getElementById('player-name-input');
        const emailPreview = document.getElementById('email-preview');
        
        nameInput.addEventListener('input', (e) => {
            const val = e.target.value.trim() || "Associate";
            const email = val.toLowerCase().replace(/\s+/g, '.') + "@org.gov";
            emailPreview.innerText = email;
            state.player.email = email;
        });

        function startGame() {
            state.player.name = nameInput.value.trim() || "Associate";
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            
            document.getElementById('desktop-name').innerText = state.player.name;
            document.getElementById('desktop-email').innerText = state.player.email;
            document.getElementById('player-email-display').innerText = state.player.email;

            updateUI();
            
            // Initial Email Message
            addLog("System Administrator", "Automated Policy Update: Please note that heating fish in the shared microwave is now a Level 2 Disciplinary Offense. Karen from HR has CC'd everyone to discuss.", "bg-blue-50 text-blue-900 border-l-4 border-blue-600 italic mb-4");
            
            setTimeout(() => {
                addLog("Karen (HR)", "Hi team, per my last email, the cleanliness of the kitchen is non-negotiable. I'm seeing a lot of pushback from Greg and Chad. Will, I need you to weigh in and support policy enforcement immediately.", "border-l-4 border-purple-500 bg-purple-50");
            }, 800);
        }

        function updateUI() {
            if (state.gameOver) return;
            const p = state.player;
            const hpPct = Math.max(0, (p.hp / p.maxHp) * 100);
            const ultPct = Math.min(100, p.ult);

            // Stats
            document.getElementById('desktop-hp-fill').style.width = hpPct + "%";
            document.getElementById('desktop-hp-text').innerText = `${Math.ceil(p.hp)}/${p.maxHp}`;
            document.getElementById('desktop-ult-fill').style.width = ultPct + "%";
            document.getElementById('mobile-hp-fill').style.width = hpPct + "%";
            document.getElementById('mobile-hp-text').innerText = Math.ceil(hpPct) + "%";

            // Ult
            const ultBtn = document.getElementById('reply-all-btn');
            ultBtn.disabled = p.ult < 100;
            document.getElementById('ult-label').innerText = `Leverage: ${Math.floor(p.ult)}%`;
            
            // Clock
            const hour = 9 + Math.floor(state.turn / 4);
            const min = (state.turn % 4) * 15;
            document.getElementById('turn-clock').innerText = `${hour.toString().padStart(2,'0')}:${min.toString().padStart(2,'0')} AM`;

            // Interactive From Line
            const selector = document.getElementById('target-selector');
            selector.innerHTML = "";
            opponents.forEach(opp => {
                const isActive = state.targetId === opp.id;
                const hpPctOpp = Math.max(0, (opp.hp / opp.maxHp) * 100);
                
                const btn = document.createElement('div');
                btn.onclick = () => { if(opp.hp > 0) { state.targetId = opp.id; updateUI(); } };
                btn.className = `target-pill px-2 py-1 flex flex-col min-w-[110px] cursor-pointer bg-white ${isActive ? 'active' : 'opacity-80'}`;
                
                btn.innerHTML = `
                    <div class="flex justify-between items-center gap-2">
                        <span class="font-bold text-[9px] truncate">${opp.name}</span>
                        <span class="text-[8px] font-mono">${opp.hp > 0 ? Math.ceil(hpPctOpp)+'%' : 'FIRED'}</span>
                    </div>
                    <div class="h-1 w-full bg-gray-200 mt-0.5">
                        <div class="h-full ${isActive ? 'bg-yellow-400' : 'bg-red-500'}" style="width: ${hpPctOpp}%"></div>
                    </div>
                `;
                selector.appendChild(btn);
            });

            // CC UI
            const ccDisplay = document.getElementById('active-ccs');
            if (p.activeBuffs.length > 0) {
                ccDisplay.innerHTML = `<strong>CC:</strong> ` + p.activeBuffs.map(b => `<span class="bg-blue-100 px-1 border border-blue-300 rounded text-blue-800 font-bold">${b.name}</span>`).join(' ');
            }
            const buffContainer = document.getElementById('buff-list');
            if (p.activeBuffs.length > 0) {
                buffContainer.innerHTML = p.activeBuffs.map(b => `<div>‚Ä¢ ${b.name}: ${b.bonus}</div>`).join('');
            }
        }

        function addLog(sender, text, classes = "") {
            const log = document.getElementById('message-log');
            const entry = document.createElement('div');
            entry.className = `message-entry p-2 border-b border-gray-100 text-xs ${classes}`;
            entry.innerHTML = `
                <div class="flex justify-between mb-0.5">
                    <span class="font-bold text-[#000080]">${sender}</span>
                    <span class="text-[9px] text-gray-400 font-mono">${document.getElementById('turn-clock').innerText}</span>
                </div>
                <div class="leading-relaxed">${text}</div>
            `;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // --- ACTIONS ---

        function performAction(type) {
            if (state.isProcessing || state.gameOver) return;
            state.isProcessing = true;

            const target = opponents.find(o => o.id === state.targetId);
            let p = state.player;

            // Apply Passive Bonuses
            p.activeBuffs.forEach(b => { if(b.effect.heal) p.hp = Math.min(p.maxHp, p.hp + b.effect.heal); });

            switch(type) {
                case 'CIRCLE_BACK':
                    let baseDmg = 14 + Math.floor(Math.random() * 6);
                    p.activeBuffs.forEach(b => { if(b.effect.damage) baseDmg += b.effect.damage; });
                    target.hp -= baseDmg;
                    let lev = 20;
                    p.activeBuffs.forEach(b => { if(b.effect.leverage) lev *= b.effect.leverage; });
                    p.ult += lev;
                    addLog(p.name, `Sent a pointed follow-up to <strong>${target.name}</strong>. "Just circling back to see if you actually read the attachment." (${baseDmg} damage)`);
                    break;

                case 'OOO':
                    const h = 25;
                    p.hp = Math.min(p.maxHp, p.hp + h);
                    addLog(p.name, `Turned on "Out of Office" auto-reply. You took a mental health break (+${h} Credibility).`, "bg-green-50");
                    break;

                case 'REPLY_ALL':
                    opponents.forEach(o => { if(o.hp > 0) o.hp -= 30; });
                    p.ult = 0;
                    addLog(p.name, `<strong>REPLY ALL:</strong> You sent a massive PDF exposing everyone's lunch receipts. Total professional carnage!`, "bg-yellow-100 font-bold border-y-2 border-yellow-500");
                    break;
            }

            if (target && target.hp <= 0) {
                target.hp = 0;
                addLog("SYSTEM", `${target.name.toUpperCase()} HAS BEEN TERMINATED (FIRED).`, "text-red-600 font-black italic uppercase text-center py-1");
                const next = opponents.find(o => o.hp > 0);
                if (next) state.targetId = next.id;
            }

            updateUI();
            setTimeout(ffaRound, 800);
        }

        function ffaRound() {
            const alive = opponents.filter(o => o.hp > 0);
            
            if (alive.length === 0) {
                state.gameOver = true;
                addLog("SYSTEM", "VICTORY. You are the last survivor of the email chain. The fridge is yours.", "bg-green-600 text-white p-4 text-center font-bold text-lg");
                return;
            }

            // Each alive opponent takes a turn
            alive.forEach((attacker, index) => {
                setTimeout(() => {
                    if (attacker.hp <= 0) return; // Might have died mid-round

                    // Logic: 40% chance to target player, 60% chance to target other alive opponents
                    let pool = [...alive.filter(o => o.id !== attacker.id), { id: 'player', name: state.player.name }];
                    let targetObj = pool[Math.floor(Math.random() * pool.length)];

                    let dmg = 8 + Math.floor(Math.random() * 10);
                    const quote = attacker.quotes[Math.floor(Math.random() * attacker.quotes.length)];

                    if (targetObj.id === 'player') {
                        // Check Dodge (Cat)
                        let dodged = false;
                        state.player.activeBuffs.forEach(b => { if(b.effect.dodge && Math.random() < b.effect.dodge) dodged = true; });
                        
                        if (dodged) {
                            addLog(attacker.name, `"${quote}" - You ignored the email because you were petting Mittens! (DODGED)`, "bg-blue-50 text-blue-600 italic");
                        } else {
                            // Defense Buff
                            state.player.activeBuffs.forEach(b => { if(b.effect.defense) dmg *= (1 - b.effect.defense); });
                            state.player.hp -= dmg;
                            addLog(attacker.name, `"${quote}" - You lost ${Math.floor(dmg)} Credibility.`, "bg-red-50 border-l-2 border-red-400");
                            // Shake UI
                            document.getElementById('game-ui').classList.add('shaking');
                            setTimeout(() => document.getElementById('game-ui').classList.remove('shaking'), 200);
                        }
                    } else {
                        // Enemy vs Enemy
                        targetObj.hp -= dmg;
                        addLog(attacker.name, `"${quote}" - They directed their frustration at <strong>${targetObj.name}</strong> instead of you! (-${dmg})`, "text-gray-500 italic");
                        if (targetObj.hp <= 0) {
                            targetObj.hp = 0;
                            addLog("SYSTEM", `${targetObj.name} was CC'd into oblivion by ${attacker.name} and has been FIRED.`, "text-red-700 font-bold");
                        }
                    }

                    if (state.player.hp <= 0) {
                        state.gameOver = true;
                        addLog("SYSTEM", "TERMINATED. You have been removed from the company Slack, Email, and Building. Security is waiting.", "bg-black text-white p-4 text-center font-bold");
                        updateUI();
                    }

                    if (index === alive.length - 1) {
                        state.turn++;
                        state.isProcessing = false;
                        updateUI();
                    }
                }, index * 600);
            });
        }

        // --- CC LOGIC ---

        function openAddressBook() {
            const list = document.getElementById('contact-list');
            list.innerHTML = "";
            CONTACTS.forEach(c => {
                const item = document.createElement('div');
                item.className = `p-2 border border-gray-300 flex flex-col ${c.used ? 'opacity-40 grayscale bg-gray-100' : 'cursor-pointer hover:bg-blue-50'}`;
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-[#000080] text-xs">${c.name}</span>
                        <span class="text-[8px] uppercase font-bold text-gray-400">${c.role}</span>
                    </div>
                    <div class="text-[10px] italic mt-1 leading-tight">${c.bonus}</div>
                `;
                if (!c.used) {
                    item.onclick = () => ccContact(c.id);
                }
                list.appendChild(item);
            });
            document.getElementById('address-book').classList.remove('hidden');
        }

        function closeAddressBook() {
            document.getElementById('address-book').classList.add('hidden');
        }

        function ccContact(id) {
            const contact = CONTACTS.find(c => c.id === id);
            contact.used = true;
            state.player.activeBuffs.push(contact);
            
            addLog(state.player.name, `Looping in <strong>${contact.name}</strong> for visibility on this thread.`, "bg-blue-100 border-l-4 border-blue-500 font-bold");
            
            closeAddressBook();
            updateUI();
            
            // Turn penalty
            state.isProcessing = true;
            setTimeout(ffaRound, 400);
        }
    </script>
</body>
</html>


